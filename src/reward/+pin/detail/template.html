<div class="reward-detail reward-detail-pin">
	<div class="zs-bar tc">
		<a [routerLink]="['/']" class="zs-back"></a>
		{{info?.cRPName}}
		<span class="pull-right state-btn" [class.state-btn-stop]="info?.cRPStatus!=1" (click)="onState()">{{info?.cRPStatus==1?'发放中':'暂停中'}}</span>
		<a class="pull-right del-btn" (click)="onDelete()"></a>
		<a class="pull-right edit-btn" [routerLink]="['/pin/edit',{id:id}]"></a>
	</div>
	<div class="rd-main">
		<div class="rx-col">
			<div class="zs-border rx-main">
				<h1>明细查询</h1>
				<div class="rx-search re-rule">
					<div class="rx-condition">
						<div class="rx-cond-label">发放日期</div>
						<div class="th-datepicker-block re-rule-pin">
							<div class="rd-btn" [class.active]="prizesParams.range===-1" (click)="onSetRange()">全部</div>
							<div class="s-input tc th-datepicker-range " (click)="onShowDate($event)">
								<input type="text" readonly  name="name" class="inputtxt" [value]="prizesParams.startDate+'~'+prizesParams.endDate" style="width:170px" value="">
								<div class="tc th-datepicker-tip" (click)="$event.stopPropagation()" *ngIf="dateShow" >
									<div class="th-datepicker" >
										<datepicker [ngModel]="prizesParams.startDate" (ngModelChange)="prizesParams.startDate = moment($event)"  [showWeeks]="true"></datepicker>
									</div>
									<div class="th-datepicker">
										<datepicker [ngModel]="prizesParams.endDate" (ngModelChange)="prizesParams.endDate = moment($event)" [showWeeks]="true"></datepicker>
									</div>
								</div>
							</div>
							<div class="rd-btn" [class.active]="prizesParams.range===7" (click)="onSetRange(7)">本周</div>
							<div class="rd-btn" [class.active]="prizesParams.range===30" (click)="onSetRange(30)">本月</div>
							<div class="rd-btn" [class.active]="prizesParams.range===90" (click)="onSetRange(90)">本季度</div>
							<div class="rd-btn" [class.active]="prizesParams.range==='currentYear'" (click)="onSetRange('currentYear')">2015</div>
							<div class="rd-btn" [class.active]="prizesParams.range==='nextYear'" (click)="onSetRange('nextYear')">2016</div>
						</div>

					</div>
					<div class="rx-condition">
						<div class="rx-cond-label">发放状态</div>
						<div>
							<div class="rd-btn" [class.active]="prizesParams.sendStatus==0" (click)="prizesParams.sendStatus=0">全部</div>
							<div class="rd-btn" [class.active]="prizesParams.sendStatus==1" (click)="prizesParams.sendStatus=1">未发放</div>
							<div class="rd-btn" [class.active]="prizesParams.sendStatus==2" (click)="prizesParams.sendStatus=2">已发放</div>
						</div>
					</div>
					<div class="rx-condition">
						<div class="rx-cond-label">兑换状态</div>
						<div>
							<div class="rd-btn" [class.active]="prizesParams.verifyStatus==0" (click)="prizesParams.verifyStatus=0">全部</div>
							<div class="rd-btn" [class.active]="prizesParams.verifyStatus==1" (click)="prizesParams.verifyStatus=1">未兑换</div>
							<div class="rd-btn" [class.active]="prizesParams.verifyStatus==2" (click)="prizesParams.verifyStatus=2">已兑换</div>
						</div>
					</div>
					<div class="rx-condition">
						<div class="rx-cond-label">关联项目</div>
						<div>
							<div class="s-input">
								<select [(ngModel)]="prizesParams.projectId">
									<option [value]="pl.cPId" *ngFor="let pl of projectsList">{{pl.cPName}}</option>
								</select>
							</div>
						</div>
					</div>
					<div class="rx-cond-op">
						<button class="rd-btn" (click)="onSearch()">查找</button>
					</div>
				</div>
				<div class="rx-list">
					<table class="table">
						<caption>
							数据列表
							<a target="_blank" [href]="onDownload()" class="zs-btn-export fr">导出数据</a>
						</caption>
						<thead>
							<tr>
								<th>序号</th>
								<th>兑换核验码</th>
								<th>发放状态</th>
								<th>兑换状态</th>
								<th>发放时间</th>
								<th>发放来源
									<div class="zs-b-des">
										<i></i>
										<div>
											此处显示的是获奖链接的原始部署对象，如门店、员工或商品。
										</div>
									</div>
								</th>
								<th>获奖手机号</th>
								<th>兑换时间</th>
								<th>核验人</th>
							</tr>
						</thead>
						<tbody *ngIf="pinList">
							<tr *ngFor="let psl of pinList;let i = index;">
								<td>{{i+1}}</td>
								<td>{{psl.cRCode}}</td>
								<td>{{psl.cRStatus!==0?'已发放':'-'}}</td>
								<td>{{psl.cRStatus===2?'已兑换':'未兑换'}}</td>
								<td>{{psl.cRSendTime|date:'yyyy/MM/dd'}}</td>
								<td>{{psl.groupName}}{{psl.cREntityName}}</td>
								<td>{{psl.cRMobile||'-'}}</td>
								<td>{{psl.cRVerifyTime|date:'yyyy/MM/dd'}}</td>
								<td>{{psl.userName||'-'}}</td>
							</tr>
						</tbody>
					</table>
					<div class="rx-list-empty tc c-pink" *ngIf="!pinList?.length">
						未查找到有效数据
					</div>
					<pagination (pageChanged)="pageChanged($event)" [totalItems]="pageCount" [(ngModel)]="currentPage" [itemsPerPage]="pageSize" class="pagination-sm"
                [boundaryLinks]="true" [rotate]="false" (numPages)="numPages = $event" firstText="首页" lastText="结束页" previousText="上一页" nextText="下一页"></pagination>
				</div>
			</div>
			<div class="zs-border rx-side">
				<div class="s-header tc">
					<h1>{{info?.cRPName}}</h1>
					<p>创建时间<span>{{info?.cRPCreateDate|date:'yMMdd'}}</span></p>
				</div>
				<div class="s-items">
					<div class="s-item" *ngFor="let tl of totalList">
						<div>
							<span>核验码总量</span>
							<span class="c-blue">{{tl.totalNum}}</span>
							<span class="s-ico s-ico-add" title="追加核验码" (click)="tl.addTotalShow=!tl.addTotalShow"></span>
						</div>
            <div class="add-total-block" *ngIf="tl.addTotalShow">
              <h5>追加核验码</h5>
              <input type="text" style="width:100px;margin-right:10px;" autofocus="autofocus" class="inputtxt input-157" placeholder="1-100,000的数字" [(ngModel)]="tl.additionalNum" (keyup)="onEnterAddTotal($event,tl)">
                <a class="rd-btn-inline" style="width:40px;" (click)="onAddTotal(tl)">确认</a>
                <a class="rd-btn-link-inline" (click)="tl.additionalNum = '';tl.addTotalShow = 0;tl.addStatus = 0;tl.additionalNumError = 0;">取消</a>
            </div>
            <div class="alert alert-success add-total-tip" *ngIf="tl.addStatus==1">
              追加成功!
            </div>
            <div class="alert alert-danger add-total-tip" *ngIf="tl.addStatus==2">
              追加失败!
            </div>
						<div class="alert alert-danger add-total-tip" *ngIf="tl.additionalNumError">
							输入1~100,000的数字,实际输入超出范围的数字,或者字母
						</div>
						<div>
							<span>已发放总量</span>
							<span class="c-green">{{tl.senderNum}}</span>
							<a class="s-ico s-ico-down" target="_blank" [href]="onDoneDownload(tl.cRPDId)"></a>
						</div>
						<div>
							<span>已兑换总量</span>
							<span class="c-green">{{tl.verfiyNum}}</span>
							<a class="s-ico s-ico-down" target="_blank" [href]="onExchangeDownload(tl.cRPDId)"></a>
						</div>
					</div>
				</div>
				<div class="s-rel">
					<div class="s-rel-title">当前项目关联</div>
					<div>
						<a *ngFor="let cpl of curProjectsList">{{cpl.cPName}}</a>
					</div>
				</div>
			</div>
		</div>
		<div class="rd-footer tc">
			2006-2016 All rights reserved 上海皓煦数据技术有限公司 沪ICP备08012157号-5
		</div>
	</div>

</div>
